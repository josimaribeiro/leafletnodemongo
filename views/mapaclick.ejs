<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <title>Cadastrar Coordenada</title>
      <link rel="stylesheet" href="/css/style.css">
    <link
      rel="stylesheet"
      href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
    />
    <style>
      #map {
        height: 400px;
        margin-bottom: 10px;
      }
    </style>
  </head>
  <body>
    <h1>Cadastrar Coordenada</h1>

    <p>Clique no mapa para preencher latitude e longitude:</p>
    <div id="map"></div>

        <form action="/coordenadas/cadastrar" method="POST" class="mb-4">
      <div class="mb-3">
        <label for="nome" class="form-label">Nome:</label>
        <input type="text" id="nome" name="nome" class="form-control" required autofocus>
        
      </div>

      <div class="mb-3">
        <label for="latitude" class="form-label">Latitude:</label>
        <input type="number" id="latitude" name="latitude" step="0.0000001" class="form-control" required>
      </div>

      <div class="mb-3">
        <label for="longitude" class="form-label">Longitude:</label>
        <input type="number" id="longitude" name="longitude" step="0.0000001" class="form-control" required>
      </div>

      <button type="submit" class="btn btn-primary">Cadastrar</button>
    </form>


        <a href="/" class="btn btn-success">Voltar ao Menu</a>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script>
      // Coordenadas de Paracambi, RJ

      // Coordenadas do centro de Paracambi
      const centroParacambi = [-22.626, -43.658];

      // Limites aproximados do município (sudoeste, nordeste)
      const limitesParacambi = [
        [-22.65, -43.68], // sudoeste
        [-22.61, -43.63], // nordeste
      ];

      // Inicializa o mapa
      const map = L.map("map", {
        center: centroParacambi,
        zoom: 13,
        minZoom: 13,
        maxZoom: 13,
        maxBounds: limitesParacambi,
        maxBoundsViscosity: 1.0,
      });

      L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
        attribution: "© OpenStreetMap contributors",
      }).addTo(map);

      // Ícone customizado
      const treeIcon = L.icon({
        iconUrl: "https://cdn-icons-png.flaticon.com/128/740/740934.png",
        iconSize: [32, 32],
        iconAnchor: [16, 32],
        popupAnchor: [0, -32],
      });

      let marker;

      // Captura clique no mapa
      map.on("click", function (e) {
        const { lat, lng } = e.latlng;

        // Atualiza campos do formulário
        document.getElementById("latitude").value = lat.toFixed(7);
        document.getElementById("longitude").value = lng.toFixed(7);

        // Remove marcador anterior
        if (marker) map.removeLayer(marker);

        // Adiciona novo marcador com ícone customizado
        marker = L.marker([lat, lng], { icon: treeIcon })
          .addTo(map)
          .bindPopup(
            `Selecionado: Lat ${lat.toFixed(7)}, Lng ${lng.toFixed(7)}`
          )
          .openPopup();
      });
    </script>
  </body>
</html>
